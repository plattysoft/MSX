11 BLOAD "editor.sc2",s

12 DEFINT A-Z

20 'TODO Make this into the main sprite list
20 A$=""
30 FOR I=1 TO 32
40   READ L: A$=A$+CHR$(L)
50 NEXT I
60 SPRITE$(63)=A$

70 GOSUB 2000

90 x=8:y=8:sa=0:sb=1

100 ' MAIN LOOP
100 S=STICK(0)

110 IF TIME<10 GOTO 300
120 IF S<>0 THEN TIME=0

210 if s=1 AND y>8 then y=y-8:sb=sb-1
230 if s=3 and x<168 then x=x+16:sa=sa+1
250 if s=5 AND y<104 then y=y+8:sb=sb+1
270 if s=7 and x>8 then x=x-16:sa=sa-1

300 put sprite 1, (x,y-1), 15, 63

430 B$=inkey$
440 if B$="0" THEN GOSUB 650
441 if B$>="1" AND B$<="9" THEN GOSUB 600
450 IF B$="S" GOTO 800
500 goto 100

600 VPOKE &H1800+sa*2+1+sb*32, VAL(B$)*2+8: VPOKE &H1800+sa*2+2+sb*32, VAL(B$)*2+9
610 RETURN

650 ' DELETE A BRICK
687 if sb MOD 2 = 0 THEN nc=97+(l MOD 3)*2:cn=96+(l MOD 3)*2 ELSE nc=96+(l MOD 3)*2:cn=97+(l MOD 3)*2
689 VPOKE &H1800+sa*2+1+sb*32, NC: VPOKE &H1800+sa*2+2+sb*32, CN
699 RETURN

800 ' Export level
810 OPEN LN$(CL) FOR OUTPUT AS #1
820 FOR J=1 TO 13
821   FOR I=0 TO 10
822     C=(VPEEK(&H1800+I*2+1+J*32)-8)/2
823     IF C>9 THEN C=0
830     PRINT #1, C;
840   NEXT I
845   PRINT #1, ""
850 NEXT J
860 RUN "playlvl.bas"

870 'LOAD THE GAME IN PLAYTEST MODE

1000 DATA &HE3,&H80,&H80,&H00,&H00,&H80,&H80,&HE3,&H00,&H00,&H00,&H00,&H00,&H00,&H00,&H00
1010 DATA &HC7,&H01,&H01,&H00,&H00,&H01,&H01,&HC7,&H00,&H00,&H00,&H00,&H00,&H00,&H00,&H00

2000 ' Editor level selection
2000 'BLOAD "edit_all.scr",s
2010 OPEN "RAFTOID.BLD" FOR APPEND AS #1: CLOSE(1)
2011 OPEN "RAFTOID.BLD" FOR INPUT AS #1
2020 DIM LN$(10):CL=0
2020 ' Read 10 levels or until EOF
2030 IF EOF(1) GOTO 2100
2040 INPUT #1, LN$(CL)
2045 TX=2:TY=CL+11:T$=LN$(CL):GOSUB 9090
2050 CL=CL+1
2060 IF CL<10 GOTO 2030
2100 ' BLOAD the world selection screen (options open, new, delete)
2100 CLOSE(1)
2101 GOSUB 8000
2110 ' TODO Use cursors to select
2110 B$=inkey$
2130 if B$="N" THEN LN$(CL)="LVL_";CHR$(CL+48);".LVL":CL=CL+1 GOTO 100
2140 if B$>="1" AND B$<="9" THEN GOSUB 600
2150 IF B$="S" GOTO 800
2160 GOTO 2110

8000 ' SAVE LIST OF LEVELS TO FILE
8000 OPEN "RAFTOID.BLD" FOR OUTPUT AS #1
8010 FOR I=0 TO 9
8020  PRINT #1, LN$(I)
8030 NEXT I
8090 CLOSE(1)
8099 RETURN

9090 ' PRINT TEXT ON SCREEN
9090 FOR i=1 to LEN(T$)
9091   CT$=MID$(T$,i,1)
9092   VPOKE &H1800+tx+ty*32+i,ASC(CT$)
9093 NEXT I
9094 RETURN
