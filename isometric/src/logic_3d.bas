100 COLOR 15,1,1:SCREEN 2,2,0
110 DEFINT A-Z
120 DIM R(255)

130 SPRITE$(0)="AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"

140 BLOAD "logic_3d.sc2",S

145 'CALL TURBO ON

200 FOR I=0 TO 7
210  FOR J=0 TO 7
220   KE=RND(1)*3
230   FOR K=0 TO 3
240    IF K<KE THEN R(I+J*8+K*64)=1 ELSE R(I+J*8+K*64)=0
250   NEXT K
260  NEXT J
270 NEXT I

310  FOR I=0 TO 7
320   FOR J=0 TO 7
321    FOR K=0 TO 0
330     IF R(I+J*8+K*64)=1 THEN GOSUB 1000
340   NEXT K
350  NEXT J
360 NEXT I

380 'CALL TURBO OFF

400 S=STICK(0)
410 IF S=1 THEN Y=Y-1
430 IF S=3 THEN X=X+1
450 IF S=5 THEN Y=Y+1
470 IF S=7 THEN X=X-1

480 IF STRIG(0) THEN GOTO 140

500 IX=(X*2-Y*2)
510 IY=(X+Y)

800 'PUT SPRITE 0,(IX,IY),15,0

890 IF TIME<2 THEN 890 ELSE TIME=0
900 GOTO 400


1000 ' Draw a tile
1010 TX=14-2*J+2*I:TY=6+I+J-K
1020 TI=TX+TY*32+&H1800

1030 CT=VPEEK(TI): ST=52
1031 IF CT=22 THEN ST=56
1032 IF CT=54 THEN ST=60
1033 IF CT=116 THEN ST=120
1034 'IF CT=118 OR CT=122 THEN ST=156
1035 'IF CT=84  THEN ST=92
1036 'IF CT=152 OR CT=212 OR CT=124 THEN ST=220
1037 'IF CT=120 THEN ST=188
1039 VPOKE TI, ST:VPOKE TI+1, ST+1

1040 CT=VPEEK(TI+3): ST=52
1041 IF CT=21 THEN ST=56
1042 IF CT=53 THEN ST=60
1043 IF CT=119 THEN ST=120
1044 'IF CT=117 OR CT=121 THEN ST=156
1045 'IF CT=87 THEN ST=92
1046 'IF CT=155 OR CT=215 OR CT=127 THEN ST=220
1047 'IF CT=123 THEN ST=188
1048 VPOKE TI+2, ST+2:VPOKE TI+3, ST+3

1050 VPOKE TI+32, 84:VPOKE TI+33, 85:VPOKE TI+34, 86:VPOKE TI+35, 87

1060 CT=VPEEK(TI+64): ST=116
1061 IF CT=84 THEN ST=148  
1070 VPOKE TI+64, ST:VPOKE TI+65, ST+1

1080 CT=VPEEK(TI+67): ST=116
1081 IF CT=87 THEN ST=148
1090 VPOKE TI+66, ST+2:VPOKE TI+67, ST+3
1099 'IF NOT STRIG(0) THEN GOTO 1099
1100 RETURN
