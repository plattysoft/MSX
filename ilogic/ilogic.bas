10 COLOR 15,1,1
20 screen 2,2,0
30 BLOAD "ilogic.sc2",s
40 defint A-Z
100 FOR K=1 TO 4 :B$="":FORI=1TO 32 :READ A$:A=VAL("&H"+A$):B$=B$+CHR$(A):NEXTI:SPRITE$ (K)=B$:NEXTK
110 DEF FN FF(X,Y)=VPEEK(&H1800+X\8+(Y\8)*32)

120 'BLOAD "l_test.asmâˆ‚",s,&H1800

190 PS=1:X=102:Y=64:VY=0:TH=0:TV=0

200 ON STICK(0) GOTO 210,220,230,,,,270, 280
201 GOTO 300
210 IF PJ=0 THEN VY=-8:PJ=1
219 GOTO 300
220 IF PJ=0 THEN VY=-8:PJ=1
221 TH=FN FF(X+16,Y+8)
222 PS=1:IF FN FF(X+16,Y+12)=0 AND TH=0 AND FN FF(X+16,Y+2)=0 THEN X=X+4
229 GOTO 300
230 TH=FN FF(X+16,Y+8)
231 IF FN FF(X+16,Y+12)=0 AND TH=0 AND FN FF(X+16,Y+2)=0 THEN X=X+4
232 IF PS=1 AND PJ=0 THEN PS=2 ELSE PS=1
239 GOTO 300
270 TH=FN FF(X,Y+8)
271 IF FN FF(X,Y+12)=0 AND TH=0 AND FN FF(X,Y+2)=0 THEN X=X-4
272 IF PS=3 AND PJ=0 THEN PS=4 ELSE PS=3
279 GOTO 300
280 IF PJ=0 THEN VY=-8:PJ=1
281 TH=FN FF(X,Y+8)
282 PS=3:IF FN FF(X,Y+12)=0 AND TH=0 AND FN FF(X,Y+2)=0 THEN X=X-4
289 GOTO 300
300 'End of movement loop 
301 'Check for floor tiles at 3 points under the sprite Y+16,(X, X+8, X+15)'
310 Y=Y+VY
320 IF VY<0 GOTO 340
330 TV=FN FF(X+8,Y+16)
331 IF FN FF(X+2,Y+16)>0 OR TV>0 OR FN FF(X+12,Y+16)>0 THEN PJ=0:VY=0:Y=Y-(Y MOD 8) ELSE PJ=-1:VY=VY+1:IF VY>8 THEN VY=8
339 GOTO 350
340 TV=FN FF(X+8,Y)
341 IF FN FF(X+2,Y)>0 OR TV>0 OR FN FF(X+12,Y)>0 THEN VY=0:Y=Y+8-(Y MOD 8) ELSE VY=VY+1:IF VY>8 THEN VY=8
350 IF TV>=160 OR TH>=160 THEN GOTO 190
390 PUT SPRITE 0,(X, Y-1),6,PS
399 GOTO 200

900 DATA 00,01,03,07,0F,1F,0F,07,03,07,0F,0E,3C,3C,30,30,08,90,E0,E0,B0,F8,F0,A0,C0,E0,F0,70,30,30,3C,3C
901 DATA 00,01,03,07,0F,1F,0F,0F,1B,03,01,07,07,07,07,01,08,90,E0,E0,B0,F8,F0,A0,C0,C0,80,80,80,80,E0,E0
902 DATA 10,09,07,07,0D,1F,0F,05,03,07,0F,0E,0C,0C,3C,3C,00,80,C0,E0,F0,F8,F0,E0,C0,E0,F0,70,3C,3C,0C,0C
903 DATA 10,09,07,07,0D,1F,0F,05,03,03,01,01,01,01,07,07,00,80,C0,E0,F0,F8,F0,E0,C0,C0,80,E0,E0,E0,E0,80
